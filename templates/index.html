<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SKU Generator</title>
<style>
    *{ background:linear-gradient(135deg,aqua);}
body { font-family: Arial, sans-serif; margin: 0; padding: 20px; display: flex; gap: 20px; }
.container { flex: 1; }
input, button { padding: 8px; margin: 5px 0; width: 100%; max-width: 300px; }
.category-input { display: flex; gap: 10px; margin-bottom: 5px; }
#barcode img { max-width: 200px; margin-top: 10px; }
.cat-name{
    width: 100%;
}
.right-column { flex: 1; border-left: 1px solid #ccc; padding-left: 20px; }
.right-column h3 { margin-top: 0; }
@media (max-width:728px) {
    .category-input{
        display: block;
    }
}
</style>
</head>
<body>

<div class="container">
    <h2>SKU & Barcode Generator</h2>
    <div id="productsContainer">
        <div class="product-input">
            <input type="text" placeholder="Product Name" class="product-name">
            <div class="categoriesContainer">
                <div class="category-input">
                    <input type="text" placeholder="Category Name" class="cat-name">
                    <input type="text" placeholder="Category Value" class="cat-value">
                    <button type="button" onclick="removeCategory(this)">‚ùå</button>
                </div>
            </div>
            <button type="button" onclick="addCategoryRow(this)">‚ûï Add Category</button>
            <button type="button" onclick="removeProduct(this)">üóë Remove Product</button>
            <hr>
        </div>
    </div>
    <button type="button" onclick="addProduct()">‚ûï Add Product</button>
    <br>
    <button id="generateBtn">Generate SKUs</button>
    <a id="downloadCSV" href="#" style="display:none" download>Download CSV</a>

    <h3>Results:</h3>
    <div id="results"></div>
</div>

<script>
function addProduct() {
    const container = document.getElementById('productsContainer');
    const div = document.createElement('div');
    div.className = 'product-input';
    div.innerHTML = `
        <input type="text" placeholder="Product Name" class="product-name">
        <div class="categoriesContainer">
            <div class="category-input">
                <input type="text" placeholder="Category Name" class="cat-name">
                <input type="text" placeholder="Category Value" class="cat-value">
                <button type="button" onclick="removeCategory(this)">‚ùå</button>
            </div>
        </div>
        <button type="button" onclick="addCategoryRow(this)">‚ûï Add Category</button>
        <button type="button" onclick="removeProduct(this)">üóë Remove Product</button>
        <hr>
    `;
    container.appendChild(div);
}

function removeProduct(btn) {
    btn.parentElement.remove();
}

function addCategoryRow(btn) {
    const container = btn.parentElement.querySelector('.categoriesContainer');
    const div = document.createElement('div');
    div.className = 'category-input';
    div.innerHTML = `
        <input type="text" placeholder="Category Name" class="cat-name">
        <input type="text" placeholder="Category Value" class="cat-value">
        <button type="button" onclick="removeCategory(this)">‚ùå</button>
    `;
    container.appendChild(div);
}

function removeCategory(btn) {
    btn.parentElement.remove();
}

document.getElementById('generateBtn').addEventListener('click', async () => {
    const productDivs = document.querySelectorAll('.product-input');
    const products = [];

    productDivs.forEach(prodDiv => {
        const name = prodDiv.querySelector('.product-name').value.trim();
        const categories = {};
        const categoryDivs = prodDiv.querySelectorAll('.category-input');
        categoryDivs.forEach(catDiv => {
            const catName = catDiv.querySelector('.cat-name').value.trim();
            const catValue = catDiv.querySelector('.cat-value').value.trim();
            if (catName && catValue) categories[catName] = catValue;
        });
        if (name) products.push({name, categories});
    });

    if (!products.length) { alert('Add at least one product'); return; }

    const response = await fetch('/generate_sku', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({products})
    });

    const data = await response.json();

    const resultsDiv = document.getElementById('results');
    resultsDiv.innerHTML = '';
    data.results.forEach(res => {
        const div = document.createElement('div');
        div.innerHTML = `
            <strong>${res.name}</strong> ‚Üí SKU: ${res.sku}<br>
            Category Heads: ${res.category_heads.join(', ')}<br>
            <ul>
                ${Object.entries(res.category_codes).map(([full, code]) => `<li>${full}: ${code}</li>`).join('')}
            </ul>
        `;
        resultsDiv.appendChild(div);
    });

    const downloadLink = document.getElementById('downloadCSV');
    downloadLink.href = `/download_csv`;
    downloadLink.style.display = 'inline';
});
</script>


</body>
</html>
